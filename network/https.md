# HTTPS
https是具有安全性的ssl加密传输协议

## 交互过程
1. Client向Server发出加密通信的请求。
> 1. 支持的协议版本，如TLS 1.0
> 2. Client生成的随机数 random1，之后用于生成"对话密钥"
> 3. 支持的加密方式，比如RSA公钥加密
> 4. 支持的压缩方式

2. Server收到请求，发送响应。
> 1. 确认使用的加密通信协议版本，如TLS1.0。如果浏览器与服务器支持的版本不一致，则关闭加密通信。
> 2. 一个Server生成的随机数 random2，之后用于生成"对话密钥"
> 3. 使用的加密方法，如RSA公钥加密
> 4. 服务器证书

3. 客户端收到证书，首先进行验证
- 验证流程
> 1. 我们知道CA机构在签发证书的时候，都会使用自己的私钥对证书进行签名证书里的签名算法字段 sha256RSA表示，CA机构使用sha256对证书进行摘要，然后使用RSA算法对摘要进行私钥签名，而我们也知道RSA算法中，使用私钥签名之后，只有公钥才能进行验签。
> 2. 如果我们使用的是购买的证书，那么很有可能，颁发这个证书的CA机构的公钥已经预置在操作系统中。这样浏览器就可以使用CA机构的公钥对服务器的证书进行验签。确定这个证书是不是由正规的CA机构颁发的。验签之后得到CA机构使用sha256得到的证书摘要，然后客户端再使用sha256对证书内容进行一次摘要，如果得到的值和验签之后得到的摘要值相同，则表示证书没有被修改过。
> 3. 如果验证通过，就会显示上面的安全字样，如果服务器购买的证书是更高级的EV类型，就会显示出购买证书的时候提供的企业名称。如果没有验证通过，就会显示不安全的提示。

- 生成随机数
> 验证通过之后，客户端会生成一个随机数pre-master secret，然后使用证书中的公钥进行加密，然后传递给服务器端

4. 服务器收到使用公钥加密的内容，在服务器端使用私钥解密之后获得随机数pre-master secret，然后根据radom1、radom2、pre-master secret通过一定的算法得出session Key和MAC算法秘钥，作为后面交互过程中使用对称秘钥。同时客户端也会使用radom1、radom2、pre-master secret，和同样的算法生成session Key和MAC算法的秘钥。

5. 然后再后续的交互中就使用session Key和MAC算法的秘钥对传输的内容进行加密和解密。


## 数据完整性

服务器在发送报文之前做了3件的事：

> 1. 用哈希算法对报文提取定长摘要
> 2. 用私钥对摘要进行加密，作为数字签名
> 3. 将数字签名附加到报文末尾发送给客户端

客户端接收到报文后：

> 1. 用公钥对服务器的数字签名进行解密
> 2. 用同样的算法重新计算出报文的数字签名
> 3. 比较解密后的签名与自己计算的签名是否一致，如果不一致，说明数据被篡改过。

同样，客户端发送数据时，通过公钥加密报文摘要，服务器用私钥解密，用同样的方法校验数据的完整性。


## 参考资料
[深入浅出HTTPS工作原理](https://blog.51cto.com/11287369/2352278)

[HTTPS原理及交互过程](https://zhuanlan.zhihu.com/p/28197870)